<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-admin"> <template> <style>:host{position:absolute}:host([hidden]),[hidden]{display:none!important}</style> <simpla-admin-controls editable="[[_editable]]" authenticated="[[_authenticated]]" on-login="login" hidden$="[[_loginOpen]]"> </simpla-admin-controls> <simpla-login id="login" active="{{_loginOpen}}"> </simpla-login> <simpla-notify></simpla-notify> </template> <script>!function(){"use strict";function e(e){var t=!!Simpla.getState("buffer");if(t)return e.returnValue=r,r}function t(e){e.keyCode===u&&e[l]&&Simpla.editable(!Simpla.getState("editable"))}function n(e){var t=document.querySelector("simpla-admin"),n=void 0;e&&!t&&(n=document.createElement("simpla-admin"),document.body.appendChild(n))}function i(){var e=window.location.hash===p;Simpla.editable(e)}function a(e){window.location.hash=e?p:""}var o={attached:function(){this._promptLoginOnEditable()},_promptLoginOnEditable:function(){var e=this,t=this.$.login,n=function(n){n&&!e._authenticated&&t.prompt().then(function(e){return Simpla.editable(e)})},i=function e(){"function"==typeof t.prompt?n(Simpla.getState("editable")):setTimeout(e,10)},a=Simpla.observeState("editable",n);i(),this._simplaObservers.push(a)}},r="You have unsaved changes, are you sure you want to leave?",s={attached:function(){window.addEventListener("beforeunload",e)},detached:function(){window.removeEventListener("beforeunload",e)}},l="altKey",u=69,d={observers:["_toggleHotkeyListener(_authenticated)"],_toggleHotkeyListener:function(e){e?document.addEventListener("keydown",t):document.removeEventListener("keydown",t)},detached:function(){document.removeEventListener("keydown",t)}},c={_simplaObservers:[],observe:function(){var e=Simpla.getState(),t=e.editable,i=e.authenticated,a=t||i;n(a),this._simplaObservers=[Simpla.observeState("authenticated",n),Simpla.observeState("editable",n)]},unobserve:function(){this._simplaObservers.forEach(function(e){return e.unobserve()}),this._simplaObservers=[]}},p="#edit",h={_simplaObserver:{},track:function(){i(),window.addEventListener("hashchange",i),a(Simpla.getState("editable")),this._simplaObserver=Simpla.observeState("editable",a)},untrack:function(){window.removeEventListener("hashchange",i),this._simplaObserver.unobserve()}},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},b=["../simpla-login/simpla-login.html","../simpla-notify/simpla-notify.html","simpla-admin-controls.html"];window.SimplaAdmin=window.SimplaAdmin||{},c.observe(),window.SimplaAdmin.hashTracking!==!1&&h.track();var y=function(){function e(){m(this,e)}return v(e,[{key:"beforeRegister",value:function(){this.is="simpla-admin",this.properties={hashTracking:{type:Boolean,observer:"_updateHashTracking",value:!0},hidden:{type:Boolean,reflectToAttribute:!0},_editable:Boolean,_authenticated:Boolean,_dependenciesImported:Boolean,_loginOpen:Boolean,_simplaObservers:{type:Array,value:[]}},this.observers=["_toggleHidden(_editable, _authenticated)"]}},{key:"ready",value:function(){f(this,window.SimplaAdmin),window.SimplaAdmin=this}},{key:"attached",value:function(){this._importDependencies(),this._syncEditableAndAuthenticated()}},{key:"detached",value:function(){this._simplaObservers.forEach(function(e){return e.unobserve()}),this._simplaObservers=[],h.untrack(),c.unobserve()}},{key:"login",value:function(){this.$.login.open()}},{key:"_toggleHidden",value:function(e,t){this.hidden=!e&&!t}},{key:"_updateHashTracking",value:function(e){e?h.track():h.untrack()}},{key:"_syncEditableAndAuthenticated",value:function(){var e=this,t=Simpla.getState(),n=t.editable,i=t.authenticated,a=function(t){return e._editable=t},o=function(t){return e._authenticated=t};a(n),o(i),this._simplaObservers.push(Simpla.observeState("editable",a)),this._simplaObservers.push(Simpla.observeState("authenticated",o))}},{key:"_importDependencies",value:function(){var e=this;this._dependenciesImported||(b.forEach(function(t){var n=document.createElement("link");n.rel="import",n.href=e.resolveUrl(t),document.head.appendChild(n)}),this._dependenciesImported=!0)}},{key:"behaviors",get:function(){return[o,d,s]}}]),e}();Polymer(y)}()</script> </dom-module> 